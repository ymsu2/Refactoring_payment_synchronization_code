# Рефакторинг кода запуска синхронизации платежей между Альфа-Банком и МойСклад

## Причина ошибки:
Код прерывает поиск после первого частично подходящего счета (return; внутри цикла). 
Если есть несколько счетов с одинаковыми agent, organizationAccount и organization, но разными номерами, платежи будут привязываться к первому найденному.
Дополнительные проблемы:
- Неточный поиск номера счета в назначении платежа (может находить частичные совпадения).
- Отсутствие проверки уникальности связки "счет-платеж".
- Сложная логика с вложенными условиями, затрудняющая анализ.

## Основные изменения представлены в файле SyncCommand(new).php:

1. Поиск лучшего соответствия:
- Добавлена система приоритетов: сначала проверяется точное совпадение номера счета, затем суммы и даты.
- Поиск всех возможных совпадений вместо прерывания после первого.

2. Точный поиск номера счета:
- Использование регулярного выражения с границами слова (\b...\b), чтобы избежать частичных совпадений.

3. Обновление оплаченной суммы:
- Явное обновление поля payedSum в счете для корректного отслеживания остатка.

4. Рефакторинг:
- Разделение на мелкие методы с понятными названиями.
- Упрощение условий.
- Удаление мутаций через &$variables.
- Использование стрелочных функций для фильтрации.

5. Обработка обновлений:
- Отдельный метод для отправки данных в API.
- Проверка уникальности обновлений перед отправкой.


